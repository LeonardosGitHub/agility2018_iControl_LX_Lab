

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Lab 4.1 - Creating the HelloWorld iControl LX Extension &mdash; Agility18 iControlLX Extensions Lab  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lab 4.2 - Updating the HelloWorld iControl LX Extension" href="lab2.html" />
    <link rel="prev" title="Module 4 - Installing the HelloWorld extension" href="module4.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Agility18 iControlLX Extensions Lab
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../class1.html">Class 1 - F5 iControl LX extensions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../module0/module0.html">Module 0 - Accessing the Lab Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../module1/module1.html">Module 1 - Understanding the iControl LX Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../module2/module2.html">Module 2 - Interacting with an iControl LX extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="../module3/module3.html">Module 3 - Understanding iControl LX Extensions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="module4.html">Module 4 - Installing the HelloWorld extension</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Lab 4.1 - Creating the HelloWorld iControl LX Extension</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#task-1-create-our-icontrol-lx-extension-on-big-ip">Task 1 - Create our iControl LX Extension on BIG-IP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-2-check-our-icontrol-lx-extension-is-working">Task 2 - Check our iControl LX Extension is Working</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lab2.html">Lab 4.2 - Updating the HelloWorld iControl LX Extension</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab3.html">Lab 4.3 - Create a New iControl LX Extension RPM</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab4.html">Lab 4.4 - Install our iControl LX RPM</a></li>
<li class="toctree-l3"><a class="reference internal" href="lab5.html">Lab 4.5 - Delete the Package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../module5/module5.html">Module 5 - Installing and Using iControlLX extension to create an ASM policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../module6/module6.html">Module 6 - Using Ansible to create an ASM policy and associate it with a Virtual Server</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Agility18 iControlLX Extensions Lab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../class1.html">Class 1 - F5 iControl LX extensions</a> &raquo;</li>
        
          <li><a href="module4.html">Module 4 - Installing the HelloWorld extension</a> &raquo;</li>
        
      <li>Lab 4.1 - Creating the HelloWorld iControl LX Extension</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/class1/module4/lab1.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="lab-4-1-creating-the-helloworld-icontrol-lx-extension">
<h1>Lab 4.1 - Creating the HelloWorld iControl LX Extension<a class="headerlink" href="#lab-4-1-creating-the-helloworld-icontrol-lx-extension" title="Permalink to this headline">¶</a></h1>
<p>iControl LX extensions are distributed as RPMs (RedHat Package Management
system) when you want to leverage something existing. However when you start
from scratch, you’ll need to create your extension and then build a RPM that
you can distribute accordingly.</p>
<div class="section" id="task-1-create-our-icontrol-lx-extension-on-big-ip">
<h2>Task 1 - Create our iControl LX Extension on BIG-IP<a class="headerlink" href="#task-1-create-our-icontrol-lx-extension-on-big-ip" title="Permalink to this headline">¶</a></h2>
<p>iControl LX extensions can be installed on either the BIG-IP or iWorkflow
platform. For this lab, we will use BIG-IP.</p>
<p>Perform the following steps to complete this task:</p>
<ol class="arabic">
<li><p class="first">Connect to your BIG-IP via SSH/Putty(<code class="docutils literal notranslate"><span class="pre">10.1.1.245</span></code>).</p>
</li>
<li><p class="first">iControl LX extensions reside in <code class="docutils literal notranslate"><span class="pre">/var/config/rest/iapps/</span></code>. This is where
you need to create your iControl LX extension. Usually you will create:</p>
<ul class="simple">
<li>A folder that is the name of your app: <code class="docutils literal notranslate"><span class="pre">HelloWorld</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This folder name is important since this is what will be used as
the RPM name when we will create our package later.</p>
</div>
<ul class="simple">
<li>Inside the app folder, another folder called <code class="docutils literal notranslate"><span class="pre">nodejs</span></code> that will contain
your extension</li>
</ul>
</li>
<li><p class="first">Let’s create our directory tree. On your BIG-IP execute the following:</p>
<p><code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">/var/config/rest/iapps/HelloWorld/nodejs/</span></code></p>
</li>
<li><p class="first">Now that we have our directory, we need to create our extension. Use your
preferred editor and create a file named <code class="docutils literal notranslate"><span class="pre">hello_world.js</span></code> in
<code class="docutils literal notranslate"><span class="pre">/var/config/rest/iapps/HelloWorld/nodejs/</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">nano</span> <span class="pre">/var/config/rest/iapps/HelloWorld/nodejs/hello_world.js</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you have not used nano before:  After you paste in the contents below, you will type <code class="docutils literal notranslate"><span class="pre">CTRL-X</span></code> to exit the editor.  You will then be prompted to save the file, type <code class="docutils literal notranslate"><span class="pre">Y</span></code> to confirm.</p>
</div>
</li>
<li><p class="first">Copy/Paste the following content into your file:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm">* A simple iControl LX extension that handles only HTTP GET</span>
<span class="cm">*/</span>
<span class="kd">function</span> <span class="nx">HelloWorld</span><span class="p">()</span> <span class="p">{}</span>

<span class="nx">HelloWorld</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">WORKER_URI_PATH</span> <span class="o">=</span> <span class="s2">&quot;ilxe_lab/hello_world&quot;</span><span class="p">;</span>
<span class="nx">HelloWorld</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isPublic</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">* handle onGet HTTP request</span>
<span class="cm">*/</span>
<span class="nx">HelloWorld</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">onGet</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">restOperation</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">restOperation</span><span class="p">.</span><span class="nx">setBody</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="s2">&quot;Hello World!&quot;</span> <span class="p">}</span> <span class="p">));</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">completeRestOperation</span><span class="p">(</span><span class="nx">restOperation</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm">* handle /example HTTP request</span>
<span class="cm">*/</span>
<span class="nx">HelloWorld</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getExampleState</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="s2">&quot;your_string&quot;</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">HelloWorld</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">Save the changes (<code class="docutils literal notranslate"><span class="pre">ESC</span> <span class="pre">ESC</span> <span class="pre">:wq</span></code> if you use <code class="docutils literal notranslate"><span class="pre">vi</span></code>).</p>
</li>
<li><p class="first">Once our extension is created, we need to load it into <code class="docutils literal notranslate"><span class="pre">restnoded</span></code>. When
an extension is loaded from an RPM, it is done automatically. However in this case
we will need to do it ourselves.</p>
<p>Use the following command on the BIG-IP to make <code class="docutils literal notranslate"><span class="pre">restnoded</span></code> aware of our
extension:</p>
<p><code class="docutils literal notranslate"><span class="pre">restcurl</span> <span class="pre">shared/nodejs/loader-path-config</span> <span class="pre">-d</span> <span class="pre">'{&quot;workerPath&quot;:</span> <span class="pre">&quot;/var/config/rest/iapps/HelloWorld&quot;}'</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">restcurl</span></code> is a utility that allows you to communicate with iControl REST via the CLI.</p>
</div>
<p>The output should look like this:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span>$ restcurl shared/nodejs/loader-path-config -d &#39;{&quot;workerPath&quot;: &quot;/var/config/rest/iapps/HelloWorld&quot;}&#39;
{
  &quot;id&quot;: &quot;ad130c79-59a0-49c7-a7e7-ff39efe956b5&quot;,
  &quot;workerPath&quot;: &quot;/var/config/rest/iapps/HelloWorld&quot;,
  &quot;generation&quot;: 1,
  &quot;lastUpdateMicros&quot;: 1508242306312732,
  &quot;kind&quot;: &quot;shared:nodejs:loader-path-config:loaderpathstate&quot;,
  &quot;selfLink&quot;: &quot;https://localhost/mgmt/shared/nodejs/loader-path-config/ad130c79-59a0-49c7-a7e7-ff39efe956b5&quot;
}
</pre></div>
</div>
</li>
<li><p class="first">The logfile <code class="docutils literal notranslate"><span class="pre">/var/log/restnoded/restnoded.0.log</span></code> will give you the ability to track
whether your extension is loaded as expected. Run the following command to
ensure everything went smoothly:</p>
<p><code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">HelloWorld</span> <span class="pre">/var/log/restnoded/restnoded.log</span></code></p>
<p>The output should look like this:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Tue</span><span class="p">,</span> <span class="mi">17</span> <span class="n">Oct</span> <span class="mi">2017</span> <span class="mi">12</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">46</span> <span class="n">GMT</span> <span class="o">-</span> <span class="n">finest</span><span class="p">:</span> <span class="p">[</span><span class="n">LoaderWorker</span><span class="p">]</span> <span class="n">triggered</span> <span class="n">at</span> <span class="n">path</span><span class="p">:</span>  <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">rest</span><span class="o">/</span><span class="n">iapps</span><span class="o">/</span><span class="n">HelloWorld</span>
<span class="n">Tue</span><span class="p">,</span> <span class="mi">17</span> <span class="n">Oct</span> <span class="mi">2017</span> <span class="mi">12</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">46</span> <span class="n">GMT</span> <span class="o">-</span> <span class="n">finest</span><span class="p">:</span> <span class="p">[</span><span class="n">LoaderWorker</span><span class="p">]</span> <span class="n">triggered</span> <span class="n">at</span> <span class="n">path</span><span class="p">:</span>  <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">rest</span><span class="o">/</span><span class="n">iapps</span><span class="o">/</span><span class="n">HelloWorld</span><span class="o">/</span><span class="n">nodejs</span>
<span class="n">Tue</span><span class="p">,</span> <span class="mi">17</span> <span class="n">Oct</span> <span class="mi">2017</span> <span class="mi">12</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">46</span> <span class="n">GMT</span> <span class="o">-</span> <span class="n">finest</span><span class="p">:</span> <span class="p">[</span><span class="n">LoaderWorker</span><span class="p">]</span> <span class="n">triggered</span> <span class="n">at</span> <span class="n">path</span><span class="p">:</span>  <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">rest</span><span class="o">/</span><span class="n">iapps</span><span class="o">/</span><span class="n">HelloWorld</span><span class="o">/</span><span class="n">nodejs</span><span class="o">/</span><span class="n">hello_world</span><span class="o">.</span><span class="n">js</span>
<span class="n">Tue</span><span class="p">,</span> <span class="mi">17</span> <span class="n">Oct</span> <span class="mi">2017</span> <span class="mi">12</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">46</span> <span class="n">GMT</span> <span class="o">-</span> <span class="n">config</span><span class="p">:</span> <span class="p">[</span><span class="n">RestWorker</span><span class="p">]</span> <span class="o">/</span><span class="n">ilxe_lab</span><span class="o">/</span><span class="n">hello_world</span> <span class="n">has</span> <span class="n">started</span><span class="o">.</span> <span class="n">Name</span><span class="p">:</span><span class="n">HelloWorld</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="task-2-check-our-icontrol-lx-extension-is-working">
<h2>Task 2 - Check our iControl LX Extension is Working<a class="headerlink" href="#task-2-check-our-icontrol-lx-extension-is-working" title="Permalink to this headline">¶</a></h2>
<p>Perform the following steps to complete this task:</p>
<ol class="arabic">
<li><p class="first">In your web browser, navigate to <code class="docutils literal notranslate"><span class="pre">https://10.1.1.245/mgmt/ilxe_lab/hello_world</span></code>.</p>
</li>
<li><p class="first">You should see something like this:</p>
<a class="reference internal image-reference" href="../../_images/lab1-image0013.png"><img alt="../../_images/lab1-image0013.png" class="align-center" src="../../_images/lab1-image0013.png" style="width: 208.0px; height: 30.0px;" /></a>
</li>
<li><p class="first">You could also use <code class="docutils literal notranslate"><span class="pre">curl</span></code> from a command line (from the BIG-IP CLI for example):</p>
<p><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">-k</span> <span class="pre">-u</span> <span class="pre">admin:admin</span> <span class="pre">https://10.1.1.245/mgmt/ilxe_lab/hello_world</span></code></p>
<p>Or a REST client like Postman.</p>
</li>
<li><p class="first">Another test is to connect to our <code class="docutils literal notranslate"><span class="pre">/example</span></code> uri. Navigate with your
browser to <code class="docutils literal notranslate"><span class="pre">https://10.1.1.245/mgmt/ilxe_lab/hello_world/example</span></code>.</p>
</li>
<li><p class="first">You should see something like this:</p>
<a class="reference internal image-reference" href="../../_images/lab1-image0022.png"><img alt="../../_images/lab1-image0022.png" class="align-center" src="../../_images/lab1-image0022.png" style="width: 200.0px; height: 33.0px;" /></a>
</li>
<li><p class="first">You can use <code class="docutils literal notranslate"><span class="pre">curl</span></code> from a command line for this as well:</p>
<p><code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">-k</span> <span class="pre">-u</span> <span class="pre">admin:admin</span> <span class="pre">https://10.1.1.245/mgmt/ilxe_lab/hello_world/example</span></code></p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may NOT want to use admin privileges to leverage an extension.
In many situations an extension may only be needed by specific users, in which case you would be able to enforce RBAC policies. BIG-IP version 13.1 provides this capability.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lab2.html" class="btn btn-neutral float-right" title="Lab 4.2 - Updating the HelloWorld iControl LX Extension" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="module4.html" class="btn btn-neutral" title="Module 4 - Installing the HelloWorld extension" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, F5 Networks.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>